const modal = document.getElementById('modal');
const span = document.getElementById("close");
const span2 =document.getElementById("close_modal2")
const img = document.getElementById("img-name");
const guardar =document.getElementById("save");
const modal_2 =document.getElementById("modal_2");
const form =document.getElementById("form");
const examinar =document.getElementById("examinar");

form.addEventListener("submit",function(e){
  e.preventDefault()
  loading()
  form.submit()
})
function loading(){
  Swal.fire({
    title: 'An√°lisis de imagen',
    html: `
    <center>
  <p>Analizando imagen con inteligencia artificial. Por favor, espere un momento....</p>
   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="200" height="200" style="shape-rendering: auto; display: block; background: transparent;" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path style="transform:scale(0.8300000000000001);transform-origin:50px 50px" stroke-linecap="round" d="M24.3 30C11.4 30 5 43.3 5 50s6.4 20 19.3 20c19.3 0 32.1-40 51.4-40 C88.6 30 95 43.3 95 50s-6.4 20-19.3 20C56.4 70 43.6 30 24.3 30z" stroke-dasharray="141.12391052246093 115.46501770019532" stroke-width="8" stroke="#00afff" fill="none">
  <animate values="0;256.58892822265625" keyTimes="0;1" dur="1s" repeatCount="indefinite" attributeName="stroke-dashoffset"></animate>
</path><g></g></g><!-- [ldio] generated by https://loading.io --></svg>
</center>
    `,
    color:"#000",
    background: "#fff",
    showCloseButton: false,
    showCancelButton: false,
    showConfirmButton: false,
    focusConfirm: false,
    allowOutsideClick: false,
  });
}
function openModal() {
    modal.style.display = 'block';
  }
  guardar.addEventListener("click",async(e)=>{
    e.preventDefault();
    try{
      save(img.value)
    }catch(error){
      console.log(error)
    }
  }
  );
  function openModaldos() {
    modal_2.style.display = 'block';
  }

  function closeModal() {
    modal_2.style.display ='none';
    modal.style.display = 'none';
  }
  
  
  span.onclick = function() {
    closeModal();
  }; 
  span2.onclick =function(){
    closeModal()
  }
  const input = document.getElementById('fileInput')
document.getElementById('examinar').addEventListener('click', function() {
     input.click();
    
});

  document.getElementById('fileInput').addEventListener('change', function(event) {
    handleFile(event.target.files);
  });



document.getElementById('drop_zone').addEventListener('dragover', function(event) {
    event.preventDefault();
    event.stopPropagation();
    this.style.borderColor = '#333';
});

document.getElementById('drop_zone').addEventListener('dragleave', function(event) {
    event.preventDefault();
    event.stopPropagation();
    this.style.borderColor = '#ccc';
});

document.getElementById('drop_zone').addEventListener('drop', function(event) {
    event.preventDefault();
    event.stopPropagation();
    this.style.borderColor = '#ccc';
    handleFile(event.dataTransfer.files);
    const droppedFiles = event.dataTransfer.files;
    input.files = droppedFiles;
    const changeEvent = new Event('change', { bubbles: true });
    input.dispatchEvent(changeEvent);
});

function handleFile(files) {
    const fileInfo = document.getElementById('fileInfo');
    fileInfo.innerHTML = '';
    for (const file of files) {
        const fileElement = document.createElement('p');
        fileElement.textContent = `Archivo: ${file.name} (${file.size} bytes)`;
        fileInfo.appendChild(fileElement);

    }
}